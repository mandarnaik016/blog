---
layout: post
title: Malware Analysis - SVG Abuse
subtitle: Where Graphics Meet Exploits
cover-img: /assets/img/analysis/analysis.webp
thumbnail-img: ""
tags: [analysis, security]
---

Hello all, long time no see!. I'm back with another malware analysis tutorial. In this post, we will examine how threat actors are abusing an SVG file for malicious purposes.

Scalable Vector Graphics (SVG) is an image format that uses XML to define vector graphics. They can be scaled without any loss in quality.

Let's start with our analysis,

A normal SVG, when opened in Notepad++, is shown below.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/sample-svg-in-npp.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/sample-svg-in-npp.png" img_alt="sample svg in npp" %}

As you can see, it is in XML format with height, width, viewbox, etc.

The following, when rendered in the browser, looks similar to an image.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/sample-svg-in-browser.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/sample-svg-in-browser.png" img_alt="sample svg in browser" %}

Now let's inspect our malicious SVG,

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/malicious-svg-in-npp.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/malicious-svg-in-npp.png" img_alt="malicious svg in npp" %}

This one also follows XML format, but when rendered in the browser, it redirects to a website,

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/malicious-svg-in-browser.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/malicious-svg-in-browser.png" img_alt="malicious svg in browser" %}

{: .box-note}
**Pssss:** Website was unreachable at that time!

If you had compared a malicious SVG with a normal SVG, you could identify that it contains an iframe with base64 encoding.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/iframe-and-base64-identified.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/iframe-and-base64-identified.png" img_alt="iframe and base64 identified" %}

The decoded base64 contains HTML data with JavaScript content as the major.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/decoded-base64.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/decoded-base64.png" img_alt="decoded base64" %}

Let's decode this JavaScript for better clarity,

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/execution-of-code-1.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/execution-of-code-1.png" img_alt="execution of code 1" %}

A variable _vart45x41_ is being defined with some string. That is later passed to a function called _varu63gup_.

At the first pointer, the string is being split, reversed, and joined.

Cyberchef could decode this as below,

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/decoding-of-code-1.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/decoding-of-code-1.png" img_alt="decoding of code 1" %}

At the second pointer, the resultant string is being replaced with a regex.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/execution-of-code-2.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/execution-of-code-2.png" img_alt="execution of code 2" %}

Cyberchef equivalent for this will be,

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/decoding-of-code-2.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/decoding-of-code-2.png" img_alt="decoding of code 2" %}

At the third pointer, the string will be split, mapped from charcode, and joined again.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/execution-of-code-3.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/execution-of-code-3.png" img_alt="execution of code 3" %}

We directly use the browser dev tools for executing this code,

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/decoding-of-code-3.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/decoding-of-code-3.png" img_alt="decoding of code 3" %}

It returned a website address to which the SVG will redirect.

At last, this piece of code will set the URL of the current page. i.e., redirects to a malicious URL.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/execution-of-code-4.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/execution-of-code-4.png" img_alt="execution of code 4" %}

The hash of SVG on Virustotal contains 4 hits at the time of writing this article.

{% include lazyimg.html img_src="../assets/img/analysis/svg-abuse/lowly/virustotal-result.jpeg" img_datasrc="../assets/img/analysis/svg-abuse/virustotal-result.png" img_alt="virustotal result" %}

It is always better to use a reputable adblocker like [uBlock Origin](https://ublockorigin.com/) or use [PiHole](https://pi-hole.net/) with adequate blocklists configured for blocking malicious URLs. No matter what level of antivirus is being installed on the system, surely they cannot protect the end users from the browser-level exploitation, just like phishing.

Thank you for being up to here. We meet next time, dissecting another sample or coming up with an evasion technique, until then Пока-пока.
